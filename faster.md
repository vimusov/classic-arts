# Почему они никогда не будут работать быстрее

*Самое главное глазами не увидеть, мозгами не понять.*
*Антуан де Сент-Экзюпери и Егор Летов*

Полтора года назад написал я статью (которую можно прочесть в Internet
Zone №119) на весьма животрепещущую тему: "Как заставить программы работать
еще быстрее?" O, святая наивность... Нет, разумеется, я написал правду -
предложенный метод "ускорения" программ вполне работоспособен и я продолжаю
успешно его использовать до сих пор несмотря на то, что давно уже сменил
Windows 98 на Windows XP. Но скажите честно: ожидая завершения работы очередного
"задумчивого" приложения, не задавались ли вы вопросом "Почему программы
работают именно с той скоростью, с какой они работают? Какой злобный монстр,
пожирающий ресурсы и отравляющий жизнь простого пользователя, прячется
во всех этих мегабайтах?". Одни по привычке винят во всем Билла Гейтса
и одну-очень-известную-операционную-систему, другие видят корень зла в
чрезмерной коммерциализации высоких технологий, третьи списывают все на
ленивых программистов, предпочитающих в рабочее время играть в тупые игрушки
вместо того, чтобы приводить в порядок свои творения. И то, и другое, и
третье имеет место, а приложив минимальные усилия, можно найти еще с десяток
очевидных причин. Но если применить к проблеме мой любимый принцип "все
связано со всем", сквозь эти разрозненные детали проступает некая система.
Темная Сторона высоких технологий. Однако мы находимся не "в одной далекой
галактике", а потому наша доморощенная Темная Сторона отлично обходится
без всякой мистики. Мы сталкиваемся с ее проявлениями настолько часто,
что уже не удивляемся очевидным несообразностям и даже более того - считаем
их совершенно естественными. Ну чтож, попробуем найти в нашей среде обитания
что-нибудь новое и удивительное. А заодно и найти ответ на самый философский
вопрос в мире - "отчего программы тормозят и глючат".

**Покупатель всегда проигрывает**

Представим себе такую ситуацию: пользователя перестала удовлетворять производительность
его компьютера. Ну там памяти для новой Windows не хватает или процессор
для последней версии Word'а уже слабоват оказался. Что обычно делают в
таких случаях? Правильно, вытаскивают старый процессор и ставят новый,
добавляют памяти, иногда еще и кулер приходится менять. Или просто отдают
компьютер в сервисный центр, где специалисты проделывают те же самые операции,
но уже за деньги. И ни у кого не вызывает удивления, что вместо "топовых"
Athlon XP или Pentium 4 (которые в свою очередь бывают с разными тактовыми
частотами - и соответственно, с разными ценами) в ту же самую материнскую
плату можно воткнуть более дешевый Дурик или Целик соответственно.

А теперь представим другую ситуацию. Вышел-таки обещанный DOOM 3. Который
все, что хуже, чем Radeon 8500 или GeForce 4 вообще за видеокарты не считает.
А посмотреть очень хочется - что для этого нужно сделать? Тоже правильно,
спихнуть кому-нибудь старую видеокарту и купить вожделенный GF4, установить
его, снести старые драйвера (вообще-то надо бы заранее, но кто об этом
помнит), потом поставить новые и надеяться, что не придется переустанавливать
Windows, которая отчего-то сильно недолюбливает такие эксперименты. А теперь
вопрос - почему нельзя как в первом случае просто заменить процессор? Или
другой вопрос - чем, к примеру, GeForce 3 Ti200 отличается от GeForce 3
Ti500, кроме цены и надписи на коробке? Только частотой работы памяти и
GPU - причем эту частоту можно регулировать программно! То есть если память
хорошая - будет Ti500, а если дешевая - Ti200. Но почему тогда нельзя наращивать
память на видеокартах стандартными модулями - ведь ни для кого не секрет,
что чипы (если, конечно, не вспоминать древние времена) используются те
же самые, что и для обычной оперативной памяти. Разумеется, производители
видеочипов и видеокарт будут отрицать наличие злого умысла и утверждать,
что от этого видеокарты будут стоить дороже - но ведь большинство пользователей
согласно один раз заплатить дороже чтобы иметь возможность постепенно улучшать
видеокарту в соответствии с потребностями. Более того, лет пять-шесть назад
некоторые видеокарты действительно позволяли наращивать память - но тут
настала эпоха 3D-ускорителей, и все стало совсем по-другому.

Конечно, производителям видеокарт выгодна ситуация, когда их продукция
морально устаревает за год-полтора, ведь кроме всего прочего это позволяет
безнаказанно снижать надежность продукции (какой смысл делать железку,
способную проработать 10 лет, если через три года ее все равно отправят
на свалку). Однако пользователь не так глуп, как хотели бы производители
железа, и отнюдь не жаждет расстаться со своими кровными. И тогда в ход
идет другой механизм сравнительно честного отъема денег у граждан - "заказные"
игры. Но об этом - четь позже, а для начала - новости "второй свежести"
из мира компьютерных игр. Все про тот же DOOM 3. А именно - как утверждают
разработчики, в этом самого DOOM 3 будут использоваться самые передовые
возможности современных видеокарт, причем в качестве "идеальной" видеокарты
предлагается Radeon 8500. Они же утверждают, что на GeForce4MX (вспомним,
как всего несколько месяцев назад геймеры радостно встречали эту железку)
смотреть на этот третий Дум будет куда менее приятно, а на GeForce 2 и
ниже работать ОНО будет так, что лучше бы вообще никак не работало. Может
быть iD Software действительно готовит нечто революционное, но меня почему-то
гложет ощущение, что готовится всего лишь очередная кампания по добровольно-принудительной
замене видеокарт. А то, понимаешь, засиделся народ на своих GF2MX и не
торопится бежать за последними достижениями - нужно срочно оживлять рынок
дорогостоящего барахла. Кстати, придумали этот прием далеко не в ATI -
совершенно аналогичным образом Microsoft подняла продажи своего XBox за
счет проекта Halo (PC-версию которого "отменили" ради этой высокой цели).

Или вот другой пример - уже из моего собственного опыта. Захотелось
мне заиметь железку для дистанционного управления компьютером - люблю я
слушать музыку лежа на диване, и подходить к компьютеру для того, чтобы
запустить очередной плейлист или подправить громкость мне нет никакой радости.
Из достоверных источников мне стало известно, что такая железка состоит
из пяти деталек и стоит никак не более двухсот рублей. С паяльником я с
детства не дружен, а потому мне показалось вполне логичным пойти в магазин
и попытаться ее купить. И тут я с удивлением выяснил, что в радиусе 60
(!!!) километров такие железки фабричного производства вообще не продаются
ни за какие деньги. Зато мне последовательно предложили приобрести беспроводную
клавиатуру (каждая из которых была хуже той, на которой я набираю этот
текст, но при этом стоила заметно дороже), CD-ROM с дистанционкой производства
Creative (которые славятся, мягко говоря, невысокими способностями к чтению
дисков) и TV-тюнер с пресловутым ПДУ! Только вот то, что мне действительно
было нужно, никто предложить не мог.

В общем, мы можем наблюдать ситуацию, когда в прайс-листах крупных фирм
все "в полном ажуре" - огромный выбор всевозможных комплектующих от разных
поставщиков. Статьи с обзорами новых железяк плодятся как тараканы, передовая
общественность затаив дыхание изучает, сколько гигабайт на кубометр способен
выдавать новый винчестер и увлеченно спорит на темы вроде "нужна ли DVD-приводам
задняя скорость". Однако при ближайшем рассмотрении оказывается, что для
рядового пользователя, не отягощенного многобаксовой зарплатой, возможности
выбора сводятся к двум позициям: "устаревшее" и "очень дорогое", причем
то, что сегодня относится к категории "очень дорогое", максимум через полгода
переходит в категорию "устаревшее". Отношение изготовителей железа (за
редким исключением) к своей работе лучше всего описывается фразой "дадим
потребителю не то, что ему нужно, а то, что нам выгодно" - и примеров тут
огромное множество. Это и "слегка" недоработанные драйвера, которые не
исправляются годами, и "мелкие недочеты" в дешевом железе (которые, конечно
же, отсутствуют в более дорогих изделиях того же типа), и умышленное ограничение
функциональности ради пропихивания на рынок более дорогих моделей: про
Intel с последними Celeron'ами и NVidia с заведомо устаревшими на момент
выхода GeForce 4MX знают все. И как ни злятся потребители, изменить уже
ничего не получится - система отлажена и приносит немалый доход.

**Враг внутри**

Вы когда-нибудь работали в ДОС 3.30? Играли в Диггера на CGA мониторе?
Пытались набирать текст с картинками в текстовом режиме? Тем, кто ни разу
этим не занимался, возможно, было бы даже интересно попробовать. Но только
один раз, чуть-чуть и чтобы не насмерть. Примерно как подержаться за высоковольтный
кабель, точно зная, что тока в нем нет. Или пощелкать у виска курком незаряженного
револьвера. Тогда поспешу вас порадовать: даже если вы сидите за самым
последним четвертым Пентиумом с самым последним и не менее четвертым GeForce,
эти нехитрые радости, за исключением, может быть, Диггера (ну слишком уж
он быстро будет бегать), вполне для вас доступны. Потому что вы за них
заплатили. А еще вы заплатили за дефективную пищалку с гордым названием
"писи-спикер". И за совместимость с дисководами калибра 5.25 дюйма, которые
еще изредка встречаются на близлежащей помойке. Загляните в Setup и вы
сами все это увидите. И никогда не забывайте, а то вдруг понадобится: ваша
чудесная звуковая карта, способная выдавать 24 бита на 96 килогерцах, всегда
готова изобразить из себя Sound Blaster Pro, а то даже и чего похуже. И
никого не волнует, что человек, купивший видеокарту за 250 у.е. даже кошмарные
сны не станет смотреть в CGA-графике, а любители звука за 80-100 заграничных
рублей проклянут самыми грязными ругательствами каждого, кто предложит
им слушать музыку в режиме "моно, 8 бит, 11 килогерц". Нет, действительно,
кому нужны все эти CGA и EGA-разрешения, совместимость с Adlib, работа
в "голом ДОСе" и прочие реликты каменного века? Чтобы работали столь же
древние и ненужные программы? Так для любой сколь-нибудь полезной программы
почти наверняка существуют аналоги под Windows и Linux. А если "в других
режимах не работает" - либо в ремонт, либо на свалку, третьего не дано.
Или вот еще одна "жизненно необходимая каждому пользователю" фича - текстовый
режим. Это чтобы из командной строки программы запускать можно было. Специально
взяли и запихнули это счастье в железо. Несмотря на то, что у многих современных
пользователей в текстовом режиме вообще нет никакой физиологической потребности,
а те, кому он нужен, вполне удовлетворились бы его эмуляцией в обычных
800*600, true color.

Казалось бы, ну и пускай они будут, все эти древние режимы, ведь никому
не мешают. Опять же "совместимость" в наличии. Конечно, все знают, что
без молотка и напильника какой-нибудь доисторический "Трайдент" в четвертый
Пентиум не воткнуть - ну и что с того, зато формально "совместимость" есть!
Но если вопрос поставить несколько иначе: "согласны ли вы заплатить хотя
бы один доллар за такую "совместимость" - большинство предпочло бы сэкономить
на том, что им совершенно не нужно. А если учесть, что все эти древние
режимы обычно были реализованы весьма замысловатым, если не сказать - бредовым,
способом (кто программировал графику в EGA-режимах, тот знает, что я имею
ввиду), то экономия пожалуй составит не один доллар, а поболее.

Но все приведенные выше примеры - ничто по сравнению с тем, что творится
внутри наших несчастных процессоров. И даже более того - уже в ближайшие
месяцы нас ожидает столь блистательный фейрверк маразма, что производителям
видеокарт останется лишь кусать локти и честно признать себя неспособными
к по-настоящему величественным глупостям. И подарит нам это незабываемое
зрелище признанный лидер в области процессоростроения, локомотив передовых
технологий, и так далее, и так далее - встречайте, AMD. Чтобы проникнуться
глубиной и величественностью замысла процессоростроителей из AMD просто
необходимо немного вспомнить историю всей линейки x86-совместимых. Иначе
ничего не получится.

Итак, в тридесятом государстве при царе Горохе сделали 16-разрядный
процессор и назвали его 8086. А на основе этого процессора соорудили некое
подобие компьютера: PC XT. Был такой зарубежный аналог БК-0010. А еще в
те же годы был Спектрум. Нет, Спектрум определенно был лучше. Но это была
уже совсем другая история. Процессор, как я уже говорил, был 16-битный,
а потому больше чем к 64 килобайтам памяти он по-человечески обращаться
не умел. Но вот ведь незадача - Тетрис в 64 килобайта еще кое-как влазил,
а вот чего посложнее - уже не всегда, поэтому было решено сделать память
из 65536 сегментов по 64 килобайта каждый. Арифметика гласит, что если
64 килобайта умножить на 65536, получится целых 4 гигабайта. Но проектировщики
твердо знали, что больше 640 килобайт ОЗУ не понадобится никому и никогда,
а потому сделали эти сегменты взаимно перекрывающимися, и ценой бессонных
ночей и каторжного труда добились того, что максимальный объем памяти все-таки
стал равен 640 килобайтам. Прогресс не стоял на месте, и подошло время
выпускать новый, 80286-й процессор. К этому времени выяснилось, что 640
килобайт все-таки маловато и новые версии Тетриса в них уже не умещаются.
А тут еще на "больших" ЭВМ обнаружилась новая модная фишка - разные программы
там работали как бы на совершенно разных машинах и, следовательно, не могли
"повесить" другие параллельно работающие задачи. Проектировщики решили:
"плохо это - когда у них есть, а у нас нет". И правильно решили. В общем,
так и появился в 286-х защищенный (правда тогда его иногда называли Extended -
"расширенный") режим. Не вдаваясь в технические подробности скажу, что
радости от такого режима было немного, а программирование под него вообще
выглядело как утонченная пытка. А поскольку среди программистов трудолюбивые
идиоты с мазохистскими наклонностями встречаются не чаще, чем крокодилы
на Колыме (это я вам как программист говорю), никто под этот режим особо
и не программировал (не считая, конечно, одну-очень-известную-фирму, которая
тогда была еще не очень известной). А потом был 32-разрядный 80386, в котором
был и нормальный защищенный режим, и возможность адресовать большие объемы
памяти без дополнительных ухищрений, и, разумеется, почти полная совместимость
с 8086 и 80286 (ибо отказ от исполнения 16-разрядных приложений в те времена
означал бы немедленное банкротство Intel). Шли годы, процессоры совершенствовались,
к производству x86-совместимых "кафельных плиток" подключились AMD, Cyrix
и многие другие. Все программы давно стали 32-разрядными. И заложенных
еще в 80386 четырехгигабайтных сегментов до последнего времени всем вполне
хватало. Правда в последние годы стало не очень понятно, какой тайный смысл
заключен в том, чтобы из года в год впихивать в процессоры поддержку 16-разрядных
программ. ДОС умер и похоронен. Windows 3.1 тоже загнулась, проткнута осиновым
колом (чтобы вдруг не ожила) и с радостными гимнами закопана под самым
высоким дубом. Вся линейка Windows 9x/Me официально отправлена Биллом Гейтсом
на пенсию и тихо ожидает своего осинового кола и надгробной плиты. Даже
колченогий уродец NT4, несмотря на свою 32-разрядность, в последнее время
сильно сдал (и, по-моему, он куда более достоин осинового кола, чем Windows
98, честно отработавшая положенный срок).

Но вот пришло новое тысячелетие, потребности в памяти выросли и оказалось,
что неплохо бы перейти на 64-разрядную адресацию, которая рассчитана на
такие огромные объемы памяти, что трудно представить, какие данные можно
в эти объемы запихать. В Intel решили, что всю эту историю с расширенными
и углубленными режимами пора заканчивать и делать совершенно новый процессор.
В AMD тоже решили - всю эту историю с расширенными и углубленными режимами
нужно продолжать! И разработали архитектуру x86-64, которая позволяет без
всяких переделок запускать на 64-разрядной машине 32-разрядные приложения.
Надеюсь вы уже прониклись величием идеи - 64-битная надстройка над 32-разрядной
версией 16-разрядного процессора! Так и хочется спросить "А Диггер? Диггер
бегать будет?" И пусть только попробуют ответить "нет"...

А мораль сей басни проста: старому хламу место на свалке. Но никак не
на рабочем столе.

**ИзнаСИлование головного мозга**

А сейчас я буду раскрывать самую темную и ужасную тайну современного программирования -
"откуда в программах берутся глюки". И начну я эту часть стандартным
в таких случаях предупреждением "детям, людям с неустойчивой психикой и
фанатам С++ данный раздел читать не рекомендуется". Ибо далее последует
огульное охаивание и охальное огуивание всего неразумного, злого и преходящего.
И, разумеется, будут злостно подрываться основы коммерческой успешности
отдельных крупных специалистов по языкам программирования. Вот видите,
мне тоже не чужд гуманизм и человеколюбие. И поэтому я заранее постарался
избавить себя, любимого, от потоков флейма на тему "С++ - самый-самый язык
программирования в мире и только полный идиот может это не понимать". В
общем, сейчас мы будем кратко знакомиться с современными языками программирования
и теми огромными возможностями по созданию глюков и багов, которые эти
языки могут нам предложить. Честно говоря, мы, передовые представители
компьютерной общественности, гордо проигнорируем всякие Паскали-Бейсики
и прочие Фортраны и сразу перейдем к самому правильному языку программирования,
на котором пишется большинство программ (тормозных и глючных, хе-хе-хе)
во всем мире. К С++. Потому что другие языки программирования нам не нужны.

На самом деле большинство людей, утверждающих, что они программируют
(или умеют программировать) на С++, в действительности программируют на
"языке, которого никогда не было", на "Классном Си" (это по аналогии с
"Объектным Паскалем", а не потому что язык такой хороший). Почему же так
мало людей программирует на "настоящем" С++? Одна из главных причин заключена
в том, что лишь терпеливый человек способен прочесть последнее издание
"Учения о программировании на С++" (конечно, Книга называется совсем по-другому,
но от этого она не становится менее священной) написанного Б. Страуструпом.
Истинно терпеливые достигают второй ступени посвящения - они знают Книгу
наизусть. Но лишь терпеливейшие из терпеливых просветляются настолько,
чтобы постигнуть смысл Книги. Почему же так мало избранных? Попробуйте
сами прочесть Книгу. Если же вы считаете, что в жизни есть много куда более
интересных вещей (и в этом я полностью с вами согласен), попробую описать
свои собственные ощущения от чтения. Должен признаться, что Книгу до конца
я так и не дочитал - силы воли не хватило.

Во-первых, это откровенно скучная Книга. Зато толстая. Книжки из серии
"про Бешеного" определенно интереснее, к тому же их содержание не обязательно
для запоминания. Во-вторых, основное содержание Книги - описание языка,
то есть правила, особые случаи, исключения из правил, исключения из исключений
из правил, исключения из исключений из исключений... - дальше, я думаю,
продолжать нет смысла. Именно поэтому Книга является не просто Книгой,
а Настольной Книгой программиста на С++ - удержать в памяти все это без
шпаргалки практически невозможно. Вот, пожалуй, и все, что я нашел в этой
книге, если не считать оглавления и предисловия. Но откуда там столько
всего взялось, что одного только описания языка хватило на толстую книгу?

Все, как всегда, просто. Сначала был маленький язык Си, который был
настолько маленьким, что даже про вещественные числа ничего не знал. А
некоторые другие языки - знали. Непорядок - и в Си добавили вещественные
числа. Потом туда же добавили много чего другого, в том числе совершенно
мистические триграфы (которые даже в справке по компилятору GCC названы
не иначе, как "brain-damage", в вольном переводе "мозги вывихнуть можно").
Потом в моду вошел объектный подход к программированию, и обычный Си срочно
переделали в Объективный (потому что объектным языком программирования
даже С++ не является - он объектно-ориентированный), а потом и в "Си два
крестика". Первый крестик - на читабельности программ, второй - на быстродействии.
Другие языки программирования тоже не стояли на месте и обрастали фенечками.
А все самые яркие и блестящие фенечки очень быстро появлялись и в С++.
В общем, фенечек стало так много, что упомнить, зачем каждая из них нужна
(и нужна ли вообще), становилось все труднее. И тогда умные люди стали
писать толстые книжки "про фенечки" и получать за это немалые деньги (вот
потому-то они и умные. Шутка).

Кстати, про умных людей. Как только стало ясно, что Си - это всерьез
и надолго, был создан комитет по стандартизации, потому как до этого компиляторы
Си писали кому как вздумается, и нехитрая (с современной точки зрения)
задача переноса чисто вычислительного алгоритма и то иногда вызывала трудности.
Язык быстро привели в порядок, но комитет на всякий случай распускать не
стали. И этот случай не замедлил появиться - как только С++ превратился
из занятной игрушки в язык, пригодный для написания программ, стандартизировать
начали уже его. К тому времени спецы из комитета по стандартизации успели
привыкнуть к насиженным креслам, ударились в академическую деятельность,
тесно связанную все с тем же С++, и вообще не горели желанием возвращаться
"к станку". Однако "за просто так" в Америке деньги платят неохотно, поэтому
требовалось срочно развить бурную, но не слишком обременительную деятельность.
Усовершенствование языков программирования в этом смысле - почти идеальное
занятие, особенно если не приходится самому реализовывать собственные ценные
указания. И долгие годы С++ углублялся, расширялся, ускорялся и перестраивался,
пока не достиг нынешнего уровня. Однако знакомые нам злобные монстрики,
выведенные в лабораториях Microsoft, Borland, и иже с ними, на самом деле
не соответствуют стандарту! Более того, нет ни одного компилятора С++,
который полностью соответствовал бы стандарту - потому что стандарт составлен
из такого количества разнородных кусков, скрепленных заплатами, что на
программирование этого ушли бы годы. А стандарт еще и изменяется - ведь
без этого невозможно было бы писать хвалебные статьи о "динамично развивающемся
языке, вобравшем в себя новейшие технологии". Нет, отрасль программирования
на С++ определенно создавали умные люди - это ведь не что иное, как действующий
вечный двигатель! Судите сами: выпущен новый стандарт - получаем процент
с продажи печатных экземпляров. Потом - платные консультации софтверным
гигантам, выпускающим компиляторы С++. Вышли новые компиляторы - начинаем
получать гонорары с книжек, в которых разъясняются новые возможности языка
и как их можно попытаться использовать. Параллельно зарабатываем научные
звания на комментариях к стандарту. На вырученные средства едим, пьем и
радуемся жизни, главное - не забыть через пять лет снова собраться и принять
очередной стандарт. Поэтому иногда я даже жалею, что когда я был маленьким,
забыл придумать С++. А теперь уже поздно.

Несомненно, С++ ждет большое будущее. Сейчас все чаще говорят о языках
программирования пятого поколения, и никто не подвергает сомнению то, что
с современными языками у них будет очень мало общего. Казалось бы, причем
тут С++ - ведь со свиным рылом в калашном ряду, как известно, делать нечего.
Однако я уверен, что выход будет найден - в С++ введут еще набор конструкций
для поддержки новой идеологии, в очередной раз озадачат производителей
компиляторов, напишут горы новых книжек и С++, как всегда, останется самым-самым
передовым и универсальным. В общем, все вернется на круги своя, и даже
искусственные интеллекты далекого будущего будут сходить с ума исключительно
по причине переполнения буфера.

Но вернемся к нашим программам. Которые, как известно, тормозят и глючат.
Чтобы никому не было обидно - мои программы тоже, бывает, страдают и тем,
и другим, а иногда даже и тем и другим одновременно. Но те, которые тормозят
и глючат сильнее, чем принято в приличном обществе, я либо дорабатываю
по мере сил, либо выбрасываю.

Первое место в рейтинге багов и глюков традиционно занимает buffer overrun
или "ой, эта штука залезла в чужую память". Врожденный дефект языка, который
более чем за 20 лет жизни не потрудился обзавестись динамическими массивами
и потому вынуждает копаться в ячейках памяти напрямую. Больше того, любая
активная работа с памятью "в стиле Си" рано или поздно кончается именно
этим - и не важно, какой язык программирования при этом использовался.

Второе место - у ошибок, связанных с выбором "не того" элемента из массива:
"так как же все-таки эти вагоны считать - с нуля или с единицы"? В Визуальном
Бэйсике - как больше нравится. В современном Паскале, который и не Паскаль
вовсе, а Delphi - так и вообще хоть с минус единицы, но, к сожалению, не
везде. В Си - только с нуля. И никак иначе. И десятый вагон в Си не десятый,
а всего лишь девятый. Это невозможно понять, это нужно запомнить. Как и
многое другое в этом языке.

Ладно, с глюками мы разобрались, теперь приступим к вопросу, который
вынесен в заголовок статьи. Почему они все-таки работают так медленно?
Но сначала расскажу одну историю. Как-то раз я написал программу, которая
перемалывала большое количество текстовых данных. Программа работала довольно
медленно - результата приходилось ждать по три минуты. Я тогда программировал
на Borland C++ Builder под Windows NT 4. Мне подумалось, что во всем виноваты
фирменные "борландовские" строки, взятые из Паскаля, и я заменил их где
только смог на классические "сишные". Стало только хуже. Тогда я вернулся
к старому варианту, начал проверять программу под Windows 98 и с удивлением
обнаружил, что под этой ОС программа работает ровно в шесть раз быстрее!
Тогда я загрузил Windows 2000 и проверил скорость работы - получил те же
30 секунд, что и в 98-м! Через весьма непродолжительное время WinNT4 была
безжалостно снесена и больше никогда не устанавливалась.

Возможно, мне просто не удалось найти правильный подход к тонкой и нежной
душе NT4, но я из своих злоключений сделал другой вывод: главное - чтобы
везде были хорошие алгоритмы. В NT4 какой-то из алгоритмов оказался плохим.
В Microsoft это заметили, исправили и в результате я получил рост производительности
в 600%. Собственно, важность использования правильного алгоритма я впервые
понял еще в седьмом классе, когда ускорил работу программы в 16 раз, переписав
в ней два десятка строчек. Более того, хороший алгоритм, реализованный
на "неправильном" языке программирования, очень часто работает гораздо
эффективнее, чем плохой алгоритм, написанный на языке "правильном". Но
в своих собственных программах каждый из нас - "царь и бог", а вот когда
неудачные алгоритмы заложены в стандарт языка программирования или недра
операционной системы - тут и начинаются настоящие проблемы с быстродействием.

К примеру, как в Си реализованы строки? Строки в Си должны заканчиваться
символом с кодом "ноль". И только какой-нибудь мальчик из детского сада
может сказать: "А почему ноль? Не хочу ноль, хочу единицу!" Такая вот современная
вариация на тему "а король-то голый". А действительно, если вдруг кому-нибудь
понадобится использовать в текстовой строке "нулевой" символ - что делать?
Вот во всяких неправильных Delphi почему-то можно пользоваться всеми символами,
а в Си - всеми, кроме одного. То есть и в Си, конечно, можно - если очень
хочется, но только про стандартные библиотеки для работы со строками в
этом случае придется забыть и писать свои собственные. В которых не будет
"проблемы номер ноль". Вообще, такой подход, когда "все символы равны,
но некоторые из них более равны, чем другие" породил огромное количество
проблем. К примеру, в ФИДО до сих пор приручают букву "Н", а некоторые
русские буквы не дают нормально работать FoxPro (а это уже куда серьезнее -
ведь программы на FoxPro, как ни странно, все еще используют в отделах
кадров и бухгалтериях).

Между прочим, этот самый "нулевой" символ в конце строки самым прямым
образом отражается на быстродействии программ, работающих со строками.
А таких программ не так уж и мало, и одна из таких программ - операционная
система (и не важно, как она называется - их сейчас все пишут на Си). Например,
если программе нужно узнать длину строки, в действительности ей приходится
"пробежаться" по всей строке, пока она наконец не наткнется на "нулевой"
символ. И такие "пробежки" программе приходится выполнять практически при
любой операции со строками. Так уж принято. И это "принято" освящено стандартом
на язык Си. А ведь кое-где принято записывать длину строки в самом ее начале -
и программе не приходится тыкать пальцем в каждую букву, чтобы узнать
сколько этих букв в слове "форточки".

Не могу не упомянуть крайне нелюбимые мной заголовочные файлы. Поначалу
я думал, что это очень хорошо - когда можно посмотреть определение любой
структуры или функции, заглянув в заголовочный файл. Хотя уже тогда мне
не нравилось, сколько времени уходит на "переваривание" этих файлов компилятором.
А потом я неожиданно для себя столкнулся с величайшим изобретением в истории
программирования - документацией. Оказывается, если она есть - нет никакой
необходимости читать файлы заголовков. Когда документация написана хорошо -
в ней содержится столько информации, сколько в заголовочный файл при
всем желании не втиснуть. А если ее нет вообще - стоит ли связываться с
кодом, который оказался не нужен даже его авторам? А заголовочные файлы
для программирования под Windows - это отдельный больной вопрос. Иногда
мне даже кажется, что эти заголовочные файлы занимают на моем винчестере
больше места, чем сама Windows. Да и компилируются программы для Windows,
написанные на С++, примерно в 10 раз дольше, чем аналогичные, но написанные
на ассемблере. Или на Delphi. Или на Visual Basic. Однако, тенденция.

Видимо, у разработчиков Си и С++ были причины сделать именно так, а
не иначе. И наверняка они понимали, что предложенные решения не идеальны.
Но почему умные люди из комитета по стандартизации не заглянули на полшага
вперед и не сказали "это, это и это не пойдет - нужно переделать"? Причин,
по-видимому, никак не меньше двух.

Причина иррациональная. Трудное детство, чугунные компьютеры, привинченные
трехдюймовыми рым-болтами к бетонному полу и единственное воспоминание
о прошлом - генералы армии США в хромовых сапогах, раздающие приказы: "или
завтра ракета полетит в квадрат Б, или послезавтра вы все полетите отсюда
без выходного пособия". И вдруг - персональные компьютеры, кофеварки с
микропроцессорами - и никаких очередей за машинным временем, бессонных
ночей, а главное - трудностей, через которые просто обязан пройти каждый
"настоящий программист". В конце-концов, это просто обидно. Но тут стареющим
бойцам невидимого фронта дали шанс. И они его не упустили: появятся завтра
квантовые компьютеры, фотонные или какие-нибудь еще - и на них сразу же
появится Си. И очередное поколение программистов будет упражняться в адресной
арифметике, запоминать, что вагоны нумеруются с нуля и зубрить правило
"написал switch - не забудь break". И им тоже будет тяжко, больно и трудно.

Причина рациональная. Хотя об этом сейчас вспоминают все реже и реже,
Си вышел не "из народа", а из недр AT'T. А телефонные компании в Америке
начала 80-х были тем же, чем стала Microsoft на гребне своего могущества
(и, надо отметить, телефонные компании в те времена любили ничуть не больше,
чем сейчас любят Microsoft), а AT'T была крупнейшей из телефонных компаний.
И все, что выходило из исследовательских центров этой компании, было обречено
на успех, ведь поддерживая ведущего игрока на рынке прогореть можно только
в одном случае - если прогорит лидер. А лидеры рынка прогорают редко. И
неважно, суждена инициативе лидера долгая жизнь, или совсем короткая, главное -
"засветиться" рядом, ухватить свою толику славы, а потом эксплуатировать
ее, эксплуатировать и еще раз эксплуатировать.

Пожалуй, пора завершать знакомство с теоретическими аспектами написания
медленных и нестабильных программ и переходить к анализу "человеческого
фактора". И, разумеется, я буду творчески переосмысливать передовой опыт
крупнейших компаний - производителей софта. Если быть до конца точным,
я буду переосмысливать опыт Microsoft - ведь именно с продукцией этой корпорации
у каждого пользователя связаны самые яркие воспоминания. Тем более, что
Microsoft у всех на виду. Надеюсь, вы не забыли мой любимый принцип - "все
связано со всем"? В общем, пора отправляться на ловлю черных кошек в темной
комнате, в которой, как известно, никаких кошек нет. Но это нас не остановит:
кто ищет, тот всегда найдет. И улов черных кошек будет богатым.

**Революция закончена, теперь - дискотека!**

Когда я слышу словосочетание "новейшая технология" в применении к компьютерам -
я знаю, что с вероятностью 90% мне в очередной раз предлагают стать жертвой
рекламной кампании. Радостно влиться в ряды пользователей
"того-не-знаю-чего-но-все-знают-что-это-круто".
Разумеется, финансово поддержать производителя (ради чего все и затевалось).
А потом, когда ажиотаж спадет, понять, что на самом деле в этом "того-не-знаю-чего-…"
в действительности мне (да и не только мне) вовсе не нужно. А через некоторое
время, когда отрицательный практический опыт сменится позитивным и прогрессивным
мышлением, появится нечто еще более новое, полезное и вообще самое-самое.
И это "нечто" срочно нужно будет купить. И так было, есть и будет - ибо
такова сущность рынка высоких технологий. Аминь.

Как это ни удивительно, многие новые технологии изначально были предназначены
не для того, чтобы сделать нашу жизнь легче. И даже не для того, чтобы
получить прибыль - достаточно вспомнить, сколько таких "новых технологий"
уже отправилось на свалку истории, оставив после себя лишь кипы ярких буклетов
и восторженные статьи в компьютерных журналах …летней давности. И каждая
из этих статей обещает революционный рост производительности, надежности,
простоты и вообще всего, что только может расти. Прошли годы, и оказалось,
что несмотря на щедрые обещания и красочные картинки на глянцевой бумаге,
на ниве "старых новых технологий" так ничего и не выросло. Очередная революция,
о которой написали столько разноцветной макулатуры, не состоялась. Знакомая
история - особенно для тех, кто иногда перечитывает старые компьютерные
журналы. Казалось бы, от таких неудавшихся технологий никто ничего не выиграл -
средства вложены немалые, а результат практически нулевой. Но не будем
торопиться с выводами.

Начнем с довольно веселой истории из области процессоростроения. Несколько
лет назад одна никому не известная компания (настолько неизвестная, что
я даже ее название вспомнить уже не могу) объявила, что разработала некую
уникальную технологию и собирается в ближайшее время выпустить процессор
с совершенно фантастической производительностью. Даже далекие от компьютерных
дел люди догадывались - таких чудес точно не бывает. Но верить в чудо очень
хотелось. Возможно, кто-то даже поверил в чудо - в любом случае новость
активно обсуждали несколько месяцев. Процессор, разумеется, так и не появился -
но благодаря ловкому блефу никому неизвестная компания на несколько месяцев
превратилась в весьма известную. Каков был экономический эффект этой PR-операции -
история, к сожалению, умалчивает.

Но это - дела дней давно минувших. Сейчас у нас другие технологии, еще
более новые. Например, .Net. Надо признать, размах у детища Билла Гейтса
глобальный - новые Интернет-сервисы, новые компиляторы, Microsoft рискнул
даже взбаламутить застоявшееся болото С++. Но действительно ли существует
объективная необходимость в этой технологии, или Билл Гейтс все никак не
может простить себе то, что в свое время не оценил потенциал Интернета
и мечтает о реванше? Или это еще один способ продвижения очередной версии
Windows - на этот раз с суффиксом .Net? А может быть все эти VB .Net и
C# следует рассматривать как очередной раунд затянувшегося спора Microsoft
и Sun о том, кто из них главнее?

Это не важно. Гораздо важнее то, как отреагировали люди на инициативу
софтверного гиганта и чем это может кончиться. Горячие головы из Linux-общественности
уже задумались о том, как добавить в свою любимую операционную систему
поддержку новой технологии от Microsoft - и это при том, что Билла Гейтса
и его корпорацию в рядах сторонников Linux откровенно недолюбливают. Основной
конкурент MS в области производства компиляторов не остался в стороне и
в авральном режиме занимается скрещиванием ежа с ужом, то есть Delphi с
технологией .Net. В околопрограммистской среде тоже уже слышны призывы
"задрав штаны, бежать за Microsoft'ом": а вдруг именно эта инициатива в
итоге перевернет рынок - в рыночных играх, как нигде более, важно своевременно
перебежать на сторону победителя.

И только сами виновники торжества хранят олимпийское спокойствие - им-то
в любом случае ничего не грозит. В первую очередь будет разыгран потрепанный
козырь "поддержки новейших технологий" - нет ничего сложного в том, чтобы
"поддерживать" технологии, которые ты сам породил и контролируешь. Если
.Net приживется - отлично, Microsoft укрепит свои позиции сразу на нескольких
направлениях. Если не приживется - тоже не беда, основные конкуренты, попытавшись
повторить неудавшуюся технологию, теряют еще больше. И в любом случае Microsoft
несколько месяцев подряд будет пожинать лавры лидера и получать политические
дивиденды, что совсем нелишне при том количестве судебных процессов, в
которых MS увязла.

А ведь воистину эпохальные события в мире информационных технологий
происходили совсем по-другому. Тихо и незаметно вошел в нашу жизнь протокол
TCP/IP, без которого Интернет мог бы быть совсем другим. Ни для кого не
секрет, что Паскаль придумал Вирт, а Си - Ричи и Керниган, но кто вспомнит
имя человека, давшего миру Бейсик? А ведь именно этот язык разрушил монополию
высоколобых интеллектуалов на программирование и подарил всем желающим
возможность самим попробовать, каково это - делать на компьютере что-то
свое вместо того, чтобы изучать инструкции к чужому софту. Когда появилась
самая первая версия Linux, не было ни глянцевых буклетов, ни презентаций,
и уж конечно ни в одном компьютерном журнале не появилось заголовка "Эта
штука изменит мир". Оказывается, по-настоящему полезные вещи отлично обходятся
без рекламной кампании. Они просто завоевывают доверие эффективностью,
надежностью, удобством. Но как же все это отличается от той действительности,
которая царит за окном…

Вот мы и посмотрели, как пекутся "новые технологии". А нужны ли они
Вам лично - это уже не мне решать. Это будут решать аналитики в недрах
корпораций.

**Краткий курс инквизиционного делопроизводства**

Позволю себе частично не согласиться с классиком русской литературы - два
важнейших вопроса в России должны звучать так: "Кто виноват?" и "Что с
ним за это надо сделать?" Потому что другой классик русской литературы
твердо сказал: преступление без наказания - это неправильно. Если быть
до конца точным, Достоевский такого не говорил, но, по мнению литературных
критиков, именно эту мысль он и хотел донести до своих читателей. Поскольку
достойного наказания за вредительское отношение к программированию на планете
Земля еще не придумали, мы просто будем искать виноватых. Итак - кто виноват
в том, что программы тормозят и глючат?

Самый простой ответ - никто. И самый неправильный. Ничто не возникает
из ничего - значит, ошибки в программе тоже кто-то сделал. Например, программист.
Если программист начинающий - другого от него ждать не приходится, но чем
объяснить вопиющие недоработки в программах, написанных профессионалами?
Приступаем к допросу подозреваемых: "Это вы налепили глюков в программе
X?" - "Мы…". "А в программе Y?" - "Ну, тоже мы. Но мы не виноваты - народу
мало, времени не хватает, компилятор глючный, инструментарий сто лет не
обновлялся…". "А кто в этом виноват?" - и тут программисты начинают дружно
показывать пальцами в одну и ту же сторону. В ту сторону, где сидят всеразличные
менеджеры - "по кадрам", "по проектам" и прочая, прочая, прочая. Чем же
провинились эти внешне совершенно безобидные существа, к тому же разбирающиеся
в программировании не больше, чем средний дворник - в вождении самолетов?

В древние времена, когда колбаса на одной шестой части суши стоила 2
рубля 20 копеек, на поверхности Земли жило-было маленькое, но гордое племя
под названием "комсюки". Они не пахали, не сеяли, зато очень любили руководить.
Неважно чем. И еще менее важно, что их компетентность в той области, которой
они руководили, обычно колебалась от "ну примерно знаю" до "а какая разница -
меня тут не для того поставили". В общем, племя было совершенно дикое,
но это им ничуть не мешало хорошо себя чувствовать. Вдруг климатические
условия резко изменились, и племя обеспокоилось вопросами выживания. Старое
название как-то примелькалось и потому было заменено на более престижное
и иностранное. Теперь они стали именовать себя "менеджерами". Затем племя
озаботилось проблемами своей низкой численности и потому в большом количестве
открыло "кузницы кадров" - всевозможные экономические школы, техникумы
и академии. Пока люди ломали головы над вопросом "чем собираются заниматься
все эти экономисты, когда их станет больше, чем денег?" - подрастающее
поколение осознало свое высокое предназначение и влилось в стройные ряды
менеджеров. И некоторым из них удалось попасть на передовой рубеж информационных
технологий (впрочем, в тылу их тоже развелось больше, чем достаточно).
На этом я, пожалуй, и завершу краткий исторический экскурс.

**И перейду к зарисовкам из жизни менеджеров**

Действующие лица: программист (П), желающий устроиться на работу; менеджер
по кадрам (М). Начало и окончание диалога опустим, как несущественные.
Итак: М: - Вы владеете С++? П: - Каким именно С++? (вполне логичный вопрос -
к примеру, С++ Builder и GCC/GXX - это две большие разницы. И из владения
вторым совершенно не следует умение эффективно программировать на первом).
М: (После недолгих раздумий) - Объектно-ориентированным… ("объектно-ориентированный
С++" это полный аналог "масляного масла" и "железного железа"). П: (Недоуменно) -
Да они вроде все объектно-ориентированные… После этой фразы результат
собеседования был предопределен. Ибо менеджеры - племя гордое, и им весьма
не по нраву, когда кто-то ловит их на вопиющей некомпетентности. Такого
они не прощают.

Программисты могут использовать эту историю в качестве анекдота. И самое
смешное в этой истории то, что это - чистая правда. А заодно - и самое
грустное. Не верите, что такое бывает? А зря. Хотя память у меня, конечно,
не компьютерная и воспроизвести диалог дословно мне, увы, не под силу -
смысл я передал абсолютно точно. Такое не забывается. Да и не один раз
я с таким сталкивался - и, видимо, еще не раз столкнусь. Просто этот случай
оказался самым ярким. Никто не находит нелогичным, что слесарями руководит
бригадир (такой же слесарь, иногда с более высоким разрядом), врачами -
врач, а военными - военный. А вот руководить программистами почему-то доверяют
людям, зачастую владеющим компьютером на уровне "набрать документ в Word"
и "запустить Quake 3". Но это еще половина беды.

Настоящая беда начинается тогда, когда менеджер начинает заниматься
самообразованием и берет в руки глянцевый "компьютерный" журнал. До этого
момента он не способен по-настоящему серьезно вмешиваться в работу программиста
по той простой причине, что не понимает, в чем она заключается. То есть
менеджер, конечно, знает, что программисты пишут программы - но сам процесс
и используемые при этом атрибуты остаются для него тайной за семью печатями.
Но вот он читает одну умную статью, затем другую, третью - а там все сплошь
новые технологии весьма специфического сорта, о которых я писал в предыдущем
разделе. Всякие CORBA, .Net и прочая. Что это такое и нужно ли оно вообще,
среднего менеджера не интересует - его интересует другое. Любая модная
технология источает весьма специфический запах - запах больших денег, и
этот запах менеджер улавливает не хуже, чем собака-ищейка. За программу
с модным лейблом можно получить с заказчика куда больше денег, чем за точно
такую же, но без "новых технологий". Поэтому нужно срочно эти технологии
осваивать - всем поголовно и в обязательном порядке. А поскольку "за бесплатно"
ничего не делается, переход на "новые технологии" самым прямым образом
отражается на стоимости программного обеспечения, в которую как раз и входят
затраты на новый инструментарий, новые компьютеры (по странному стечению
обстоятельств новые технологии весьма неохотно работают на старом железе)
и бесчисленные командировки все тех же менеджеров.

В общем, деньги тратятся на что угодно, но только не на то, на что следовало
бы. И если вы думаете, что это исключительно российская проблема - вы глубоко
ошибаетесь. Наши менеджеры пока еще не доросли до оригинальных решений
и всего лишь перенимают передовой опыт стран Запада. Не так давно я с огромным
удивлением узнал, что в Microsoft некоторые разработчики до сих пор используют
тот же инструментарий, который использовали при написании Windows 95. Причем
не потому что тамошние программисты такие ретрограды, а потому что в Microsoft
много менеджеров. И эти менеджеры таким вот образом оптимизируют (читай -
безбожно урезают) расходы на переобучение персонала. Ну и какой софт
можно написать с таким инструментарием? А вы говорите - "Винда глючит"…

**Серым прямоугольникам посвящается**

Долгое время пользователей не баловали красивым софтом. Можно даже сказать,
держали в черном теле. Действительно - во времена DOS был сплошной text
mode. Да и железо было такое, что не до красоты - уместить бы программу
в оперативку, да еще чтобы для данных немного места осталось. Потом появилась
Windows 3.1 - с 16-цветными обоями, иконками сорта "сделано топором" и
откровенно минималистскими интерфейсами программ в стиле "сверху менюшка,
снизу кнопка, а посередине - всякая чушь". И все это на ярко-белом фоне,
от которого болели глаза и дохли мониторы. А потом появилась Windows 95
и свинцово-серые окна с синей полосой сверху на долгие семь лет оккупировали
пользовательские десктопы. В пылу маркетинговых битв (где Windows 95 была
секретным оружием против IBM и ее OS/2) про эстетические чувства как-то
не потрудились вспомнить, а потому пользователю приходилось разглядывать
исключительно 16-цветные иконки от Windows 3.1 и точно такие же обои. Впрочем,
в те времена компьютеры были такие, что было не до обоев с иконками. Прошли
годы, старые компьютеры наконец-то сгорели и были заменены более-менее
новыми, видеокарты сильно изменились - то ли к лучшему, то ли просто стали
быстрее; Sound Blaster'ы издали последний писк и умерли вместе с шиной
ISA. По сравнению с 95-м годом все стало совсем по-другому. И только Винда
осталась такой, как была.

И вот свершилось! В Редмонде наконец решили выпустить Windows "с человеческим
лицом", то бишь с оригинальным интерфейсом, в котором было бы поменьше
прямых углов. Примитивные иконки отправили на свалку и заменили полноцветными.
Появились полупрозрачные элементы, анимация, плавно "всплывающие" и "выезжающие"
окна. Не забыли даже про Скрепыша - его новая инкарнация поселилась в недрах
Windows под именем Тузик. В общем, программистам и дизайнерам пришлось
изрядно потрудиться, чтобы превратить старый и серый Windows 2000 в нечто
приятное для глаза.

А что пользователи? Пользователи - они бывают разные. Одни послушали
"квалифицированные" советы и решили, что им на "слабеньком" Celeron 300
с "жалкими" 192М памяти такое счастье не светит и остались на своем староглючном
98SE. Потому как умные люди говорили "XP нужен гигагерц и гигабайт, иначе
не запустится". Лично я все "квалифицированные" советы проигнорировал и
безо всяких сверхусилий водрузил WinXP на Pentium 166MMX с 160М ОЗУ. Вопреки
утверждениям "специалистов", оно работало ничуть не медленней, чем Windows 98.
Зато куда как стабильнее. И даже большую часть "спецэффектов" не пришлось
отключать - а уж тем более не потребовалось возвращаться к классическим
серым прямоугольникам. Другие, счастливые обладатели гигагерца и гигабайта,
которые поставили новую игрушку от Гейтса, почитали FAQ'и, порадовались
веселенькому интерфейсу со скругленными окнами и тоже бед не знали. Глядя
на этот праздник жизни, широкая общественность оценила, чем им "грозит"
новая ОС и потянулась вливаться в ряды пользователей Windows XP - иногда
даже толком не зная, ради чего это делается. Нет, сбежать с 98-ки, которая
больше шести часов активной работы физически не выдерживает, вполне логично
и естественно. Но вот глубокий смысл установки XP на машины с 64М ОЗУ,
видимо, навсегда останется для меня тайной. Видимо, эти умельцы надеялись
затвикать ее так, чтобы первый Пентиум чудесным образом превратился в четвертый.

Недовольны новой операционкой остались только две группы людей: владельцы
особо древнего или особо хитрого железа, которым с XP работать отказалась.
И "профессионалы" того сорта, которые готовы даже на Pentium 4 воткнуть
самый первый релиз Windows 95 "потому что он быстрее работает и скругленные
окна систему не тормозят". Если у человека в детстве любимым героем был
Скупой Рыцарь и поэтому он стал патологически жаден до MIPS'ов, FPS'ов
и прочих "попугаев", в которых измеряют производительность - это, как говорится,
надолго. Но насколько объективны их претензии к скругленным окнам? Действительно
ли красивый интерфейс замедляет работу операционной системы? Увы, точные
цифры, насколько сильно скругленные окна портят жизнь пользователю, никто
не приводит. И причина не в том, что это так трудно измерить - при минимальном
желании разработать и провести соответствующие тесты не так уж сложно.
Но вряд ли это когда-либо сделают, ведь публикация реальных цифр раз и
навсегда выбьет почву из-под ног не только у поклонников серых прямоугольников,
но и повлияет на продажи всевозможных утилит для "тонкой настройки операционной
системы". А это, между прочим, целая коммерческая область, где важен не
прирост производительности ЭВМ пользователя, а динамика роста прибыли у
продавца. Чем больше твиков - тем "круче" продукт и, соответственно, выше
продажи. Только и всего.

А теперь задумаемся над тем, много ли времени тратится на рисование
скругленных окошек. Жалкие миллисекунды. Причем перерисовка окон происходит
сравнительно редко. А невидимые окна не перерисовываются вообще. Та же
самая история и со сглаживанием шрифтов - я сам видел человека, который
упорно не включает антиалиасинг из соображений "максимальной производительности".
Не знаю, принесла ли ему чувство глубокого удовлетворения экономия этих
самых миллисекунд, но зазубренные шрифты выглядели на редкость уродливо.
Конечно, существуют "спецэффекты", которые действительно нещадно загружают
процессор - всевозможные всплывающие полупрозрачные панели, анимированные
картинки на пол-экрана и тому подобное. Но, как правило, профессионально
выполненные программы этим не страдают - из исключений вспоминаются разве
что пресловутые Скрепыш с Тузиком.

В некоторых случаях отключение всех "красивостей" действительно имеет
смысл - например, на серверах или просто при катастрофическом недостатке
ресурсов. Но в любом случае не стоит забывать, что конечная цель всех этих
действий - не мифическая "тонкая настройка", а получение реальных дополнительных
процентов производительности. И если эти проценты не видны невооруженным
глазом - есть ли смысл вмешиваться в работу системы? В конце-концов, если
рассматривать домашний компьютер как средство для отдыха (хронических трудоголиков
в расчет не берем), нельзя забывать и об эстетической стороне. Если "рабочий
стол" не вызывает никаких эмоций кроме уныния, какая тогда вообще необходимость
держать дома столь сложную и дорогую технику? В общем, моя принципиальная
позиция в том, что можно и нужно пожертвовать жалкими миллисекундами (в
разумных, разумеется, пределах, которые каждый устанавливает для себя сам)
ради избавления от серости хотя бы в пределах собственного компьютера.
Нехорошо это - экономить на себе, любимом. А о производительности голова
должна болеть прежде всего у тех, кому это по должности положено.

**Мальчиш-плохиш и его буржуинская тайна**

Теперь, для разнообразия, поговорим о политике. Вообще-то я не политик.
К тому же с некоторых пор у меня развилась тяжелая и, скорее всего, неизлечимая
аллергия на политику вообще. Меня больше интересует софт. И вот именно
поэтому я и буду говорить про политику. А чтобы те, кто хотел услышать
от меня политические лозунги, не остались разочарованными, один лозунг
я все-таки скажу: "Следующим Президентом должен быть программист! Только
программисты умеют писать работающие программы".

Каким странным ветром занесло мою мысль в области, столь далекие от
проблем информационных технологий? Не злоупотребил ли я своим любимым принципом,
связав качество программного обеспечения с политикой? Увы, политика все-таки
влияет на программное обеспечение самым прямым образом. И речь пойдет не
о вечном споре линуксоидов с виндузятниками. Эти две группы, наряду с вымирающими
полуосниками и иными любителями экзотики, погоды на десктопе не делают.
Погоду делают с одной стороны крупные корпорации - производители софта
и с другой стороны - Фонд Свободного ПО (FSF) и разработчики крупных open
source - проектов. До тех пор, пока боевые действия между этими группировками
велись исключительно в области совершенствования софта, пользователю беспокоиться
было не о чем, а что лучше - Gimp или Photoshop, каждый решал для себя
сам.

Но наступил момент, когда одна не очень известная операционная система
вдруг стала довольно известной, и из-за этого начали снижаться продажи
другой очень известной операционной системы. Потом стало еще хуже - какие-то
умники ухитрились своими силами написать приличный web-сервер со всем сопутствующим
софтом и даже вторглись в святая святых - взялись писать свое офисное ПО.
К тому же все эти хорошие вещи они стали раздавать забесплатно, да еще
и с исходными текстами. Но самое ужасное было в том, что они сочинили для
всех своих программ особую лицензию GPL, которая по сути была утонченным
издевательством над всеми остальными лицензионными соглашениями.

И тут руководство компании, выпускающей очень известную операционную
систему, не выдержало и применило запрещенный в приличном обществе прием.
Без объяснения причин весь бесплатный софт был объявлен "потенциально вирусным".
Логики, конечно, в этом никакой - но это было неважно. Главное - покрепче
прилепить на ненавистные программы ярлык неблагонадежных. Момент тоже был
выбран не случайно - в то время как раз бушевала эпидемия "почтовых" вирусов
(которые, как ни удивительно, лучше всего плодились и размножались при
помощи почтового клиента именно этой компании). По идее, испуганный пользователь
должен был в ужасе выкинуть в окно свой винчестер вместе со всем установленным
на нем бесплатным софтом. Но пользователь оказался умнее, чем предполагалось,
и в откровенную чушь так и не поверил. В общем, оригинальные воззрения
Microsoft на проблему борьбы с вирусами привели только к падению их собственного
рейтинга.

Но в Microsoft так просто сдаваться не привыкли и тут же сочинили новый
лозунг: "Когда ты программируешь под GPL - ты программируешь коммунизм".
Вот так - не больше, не меньше. Надо сказать, в Америке коммунизм - это
хорошо раскрученная торговая марка. Такая же, как "Кока-кола" и "Мак-Дональдс",
только со знаком "минус". И дедушка Ленин - это просто Дарт Вейдер без
шлема. А в сознании среднего американца коммунизм - это вообще что-то вроде
Годзиллы в ушанке, который бродит где-то в Сибири и мечтает только об одном:
добраться до Америки, выпить всю кока-колу и сожрать все хот-доги. После
чего все настоящие американцы неизбежно впадут в великую депрессию, не
смогут больше заниматься бизнесом и вымрут. И потому каждый настоящий американец
должен повесить в комнате американский флаг, ежедневно пить "Кока-колу",
а главное - держаться подальше от проклятых пингвинов, которые пахнут коммунизмом,
и тогда у него не будет никаких проблем.

Однако в самом затруднительном положении наверняка оказались именно
коммунисты. Это что же получается - столько старались, и все - зря, а для
полной и окончательной победы коммунизма нужно было всего-то засесть за
компьютеры и программировать, программировать и программировать? И куда
девать новоявленного классика марксизма-ленинизма из Microsoft - тоже непонятно,
ведь все места в "коммунистической троице" давно уже заняты. Да и происхождение
лозунга совсем не пролетарское, а скорее даже и буржуинское. Впрочем, вполне
возможно, что где-нибудь на Кубе или в Китае написали этот лозунг на кумаче
белой краской да и повесили в комнате с программистами в качестве боевого
стимула.

А вот у рядовых пользователей появился серьезный повод для беспокойства -
ведь раньше никому и в голову не приходило, что софт можно делить по
партийной принадлежности. А вот теперь оказалось, что у некоторых программ
ни с того ни с сего отросли первичные партийные признаки. Хотя в действительности
за всеми "антивирусными" и "политическими" выпадами Microsoft кроется элементарное
желание "утопить" сильного конкурента любой ценой. Видимо, все насквозь
прогнило в Датском королевстве (то есть в мире коммерческого ПО), если
для завоевания рынка приходится извлекать на свет идеологические маразмы
50-летней давности. А какой лозунг будет дальше - "убей "пирата"? А что,
был в старые недобрые времена в Америке лозунг "убей Ивана", а история
имеет нехорошее свойство повторяться…

Но может быть нам, пользователям, будет какая-нибудь особая радость,
если не останется бесплатного софта? Да нет, скорее даже наоборот. И дело
даже не в пресловутой "халяве" - после этого производители коммерческого
софта утратят основной стимул к совершенствованию своей продукции, ведь
бесплатный софт традиционно был очень сильным конкурентом софту платному.
Да и вообще это очень хорошо - когда есть много разных интересных программ,
которые можно устанавливать, сравнивать и выбирать из них самые лучшие,
быстрые и надежные. И уж совсем хорошо, когда за них не приходится платить.

**Софт, который не нужен никому**

И, под занавес, попытаемся разобраться, почему многие широко известные
программы далеко не так хороши, как могли бы быть. Однако при этом очень
популярны. И в чем вообще секрет популярности, прямо скажем, не самого
лучшего софта.

Возьмем, к примеру, программу, которая по популярности отстает разве
что от Microsoft Office, а именно - WinAmp. Если посмотреть на WinAmp версий 2.xx
непредвзято - программа откровенно слабая: звук "неживой" и невыразительный
(и это почему-то не лечится никакими плагинами), пользоваться этой программой
при разрешении выше, чем 1024*768 затруднительно - настолько все мелкое,
"горячие" клавиши в свернутом виде WinAmp не понимает, мультимедийные -
тем более, поддержка скинов реализована по самому примитивному варианту.
В общем, перечислять можно долго. Сильных сторон - две: во-первых, простота
в обращении и во-вторых, возможность написания плагинов (которых уже написано
великое множество). И тем не менее, именно эту программу многие устанавливают
сразу после установки Windows. Казалось бы, недостатки очевидны, пути совершенствования
программы - тоже, осталось только все это реализовать. И вот года два назад
Nullsoft заявляет о разработке WinAmp 3. Больше года пользователей кормили
рассказами, о том, какое счастье их ожидает в ближайшем будущем, исправно
снабжали кривыми бета-версиями, официальный сайт пестрел намеками на некую
революционную технологию "оскинячивания" приложений. Устроили даже социологический
опрос "согласны ли Вы приобрести WinAmp 3, если он станет shareware?" В
общем, вполне профессионально создавали интригу вокруг предстоящего релиза.
И вот, когда долгожданный день настал, оказалось, что гора родила мышь.
Нет, скорее даже не мышь, а полудохлую, но довольно прожорливую крысу.
Звук определенно лучше не стал, нормальная поддержка "горячих" клавиш так
и не появилась. Внешний вид программы по умолчанию, по видимому, не менялся
со времен самой первой версии и не изменится еще долго - хотя, казалось
бы, переход к новой версии это отличный повод продемонстрировать все возможности,
предоставляемые Wasabi. Зато напрочь исчезла совместимость с плагинами
и прочим WinAmp-ориентированным софтом, а проблема с русскими названиями
песен в WinAmp 3 пока вообще не имеет приемлемого решения.

Для чего выпустили WinAmp 3? Кто-то скажет "для "галочки" - и в чем-то
будет прав. Этому даже есть косвенное подтверждение - после версии 3.0
вышла не версия 3.01, а, как ни странно, 2.81. Да и давно уже ни для кого
не секрет, что даты выпуска новых версий программ во многом определяется
не реальной потребностью пользователей, а совершенно другими факторами.
Например, чтобы люди не забывали посещать сайт авторов и разглядывать цветистые
баннеры. Или чтобы пользователь своевременно приобретал более свежую версию
программы - разумеется, с очень выгодной скидкой. Причин может быть много,
и какая из них породила WinAmp 3, мы вряд ли узнаем. Очевидно лишь то,
что третий WinAmp был сделан так, как будто его создателей меньше всего
беспокоило, будут ли этой программой пользоваться.

Для порядка поинтересуемся, как обстоят дела у самого альтернативного
проигрывателя - Windows Media Player. Разумеется, судить будем по самой
современной на сегодня версии - восьмой. Потому что WMP 6.4 можно сказать
только одно: он есть, но лучше бы его не было. А вот в WMP 8 есть все,
чего мы так и не дождались от WinAmp - и качественный звук, и поддержка
мультимедийных клавиатур, и "шкурки" с нетривиальным дизайном. Казалось
бы, бери и пользуйся, мешает лишь одно серьезное "но". А именно - работа
с плейлистами в Media Player'е реализована весьма оригинально и требует
весьма серьезных умственных усилий. А ведь эта программа вроде бы предназначена
для того, чтобы играть музыку, а не для тренировки интеллекта пользователя.
В общем, чтобы пользоваться восьмым Media Player'ом нужно желание это делать.
А откуда взяться такому желанию, если есть WinAmp?

Да и вообще многие возможности, предоставляемые Windows, выглядят какими-то
урезанными или не доведенными до своего логического завершения. Например,
встроенный просмотрщик графических файлов из Windows XP почему-то умеет
просматривать картинки в полноэкранном режиме. В стандартном окне открытия
или сохранения файла слева есть панель, на которой расположены кнопки для
перехода в часто используемые директории - но перенастроить эти кнопки
на свои директории без использования твикеров невозможно, да и количество
этих кнопок почему-то ограничено числом пять. К стандартному регулятору
громкости почему-то за почти 10 лет никто так и не захотел приделать управление
"горячими" клавишами, хотя такое решение, что называется, лежит на поверхности.
А уж Блокнот, который не претерпел существенных изменений со времен Windows
3.1, вообще давно стал притчей во языцех. Такой вот странный софт - вроде
бы и есть, а вроде - и нет. По крайней мере, не так-то просто найти человека,
который бы принимал всерьез Блокнот или "графический редактор" Paint.

Microsoft по этому поводу хранит молчание - наверное, у них нашлись
дела поважнее, чем совершенствовать стандартный набор приложений, поставляемых
с Windows. Тем более, что прибыли от этого никакой, одни расходы. А может
быть, верхах решили, что всех денег все равно не заработать, а потому нужно
оставить множество мелких недоработок и дать хлеб многочисленному племени
шароварщиков - писателей твикеров и заменителей Блокнота. Тоже ведь вроде
как младшие братья по разуму - тем более, что писатели мелких утилит при
всем желании не смогут составить конкуренцию софтверному гиганту. Так что
ворон ворону глаз не выклюет. А нам остается только попрощаться с мечтой
получить весь базовый софт в комплекте с операционной системой, если эта
операционная система - Windows.

Вот мы и прошли все круги ада и выяснили, каким образом пекутся кривые
и глючные программы, пожирающие ресурсы и мало что дающие взамен. И все
"объективные причины" в итоге свелись к одной - слишком многим выгодно,
чтобы софт был кривым. Ведь идеальную программу можно продать только один
раз - именно потому, что она идеальна и в ней нечего исправлять. В поисках
ответа на вопрос, вынесенный в заголовок статьи, мы исследовали едва ли
не все "темные комнаты" современной софтверной индустрии. Чтож, я надеюсь,
что во время путешествия по кругам программистского ада вы узнали много
нового и интересного. И, как вы наверняка заметили, в этом программистском
аду всем заправляет "желтый дьявол". Если программы тормозят, значит это
кому-то выгодно.
